2,91c2,39
< TYPEID Main
< INHERITS
< TYPEID IO
< '{'
< OBJECTID main
< '('
< ')'
< ':'
< TYPEID SELF_TYPE
< '{'
< '('
< LET
< OBJECTID c
< ':'
< TYPEID Complex
< ASSIGN
< '('
< NEW
< TYPEID Complex
< ')'
< '.'
< OBJECTID init
< '('
< INT_CONST 1
< ','
< INT_CONST 1
< ')'
< IN
< '{'
< IF
< OBJECTID c
< '.'
< OBJECTID reflect_X
< '('
< ')'
< '='
< OBJECTID c
< '.'
< OBJECTID reflect_0
< '('
< ')'
< THEN
< OBJECTID out_string
< '('
< STR_CONST "=)\n"
< ')'
< ELSE
< OBJECTID out_string
< '('
< STR_CONST "=(\n"
< ')'
< FI
< ';'
< IF
< OBJECTID c
< '.'
< OBJECTID reflect_X
< '('
< ')'
< '.'
< OBJECTID reflect_Y
< '('
< ')'
< '.'
< OBJECTID equal
< '('
< OBJECTID c
< '.'
< OBJECTID reflect_0
< '('
< ')'
< ')'
< THEN
< OBJECTID out_string
< '('
< STR_CONST "=)\n"
< ')'
< ELSE
< OBJECTID out_string
< '('
< STR_CONST "=(\n"
< ')'
< FI
< ';'
< '}'
< ')'
< '}'
< ';'
< '}'
< ';'
---
>  Ma#1 IN
>  #1 INHERITS
>  IO {
>     ma#1 IN
> () : SELF_TYPE {
> 	(#1 LET
>  c : Complex <- (#1 NEW
>  Complex).#1 IN
> it(1, 1) #1 IN
> 
> 	    {
> 	        -- trivially equal (see CoolAid)
> 	        #1 IF
>  c.reflect_X() = c.reflect_0()
> 	        #1 THEN
>  out_str#1 IN
> g("=)\n")
> 	        #1 ELSE
>  out_str#1 IN
> g("=(\n")
> 	        #1 FI
> ;
> 		-- equal
> 	        #1 IF
>  c.reflect_X().reflect_Y().equal(c.reflect_0())
> 	        #1 THEN
>  out_str#1 IN
> g("=)\n")
> 	        #1 ELSE
>  out_str#1 IN
> g("=(\n")
> 	        #1 FI
> ;
> 	    }
> 	)
>     };
> };
> 
93,281c41,120
< TYPEID Complex
< INHERITS
< TYPEID IO
< '{'
< OBJECTID x
< ':'
< TYPEID Int
< ';'
< OBJECTID y
< ':'
< TYPEID Int
< ';'
< OBJECTID init
< '('
< OBJECTID a
< ':'
< TYPEID Int
< ','
< OBJECTID b
< ':'
< TYPEID Int
< ')'
< ':'
< TYPEID Complex
< '{'
< '{'
< OBJECTID x
< '='
< OBJECTID a
< ';'
< OBJECTID y
< '='
< OBJECTID b
< ';'
< OBJECTID self
< ';'
< '}'
< '}'
< ';'
< OBJECTID print
< '('
< ')'
< ':'
< TYPEID Object
< '{'
< IF
< OBJECTID y
< '='
< INT_CONST 0
< THEN
< OBJECTID out_int
< '('
< OBJECTID x
< ')'
< ELSE
< OBJECTID out_int
< '('
< OBJECTID x
< ')'
< '.'
< OBJECTID out_string
< '('
< STR_CONST "+"
< ')'
< '.'
< OBJECTID out_int
< '('
< OBJECTID y
< ')'
< '.'
< OBJECTID out_string
< '('
< STR_CONST "I"
< ')'
< FI
< '}'
< ';'
< OBJECTID reflect_0
< '('
< ')'
< ':'
< TYPEID Complex
< '{'
< '{'
< OBJECTID x
< '='
< '~'
< OBJECTID x
< ';'
< OBJECTID y
< '='
< '~'
< OBJECTID y
< ';'
< OBJECTID self
< ';'
< '}'
< '}'
< ';'
< OBJECTID reflect_X
< '('
< ')'
< ':'
< TYPEID Complex
< '{'
< '{'
< OBJECTID y
< '='
< '~'
< OBJECTID y
< ';'
< OBJECTID self
< ';'
< '}'
< '}'
< ';'
< OBJECTID reflect_Y
< '('
< ')'
< ':'
< TYPEID Complex
< '{'
< '{'
< OBJECTID x
< '='
< '~'
< OBJECTID x
< ';'
< OBJECTID self
< ';'
< '}'
< '}'
< ';'
< OBJECTID equal
< '('
< OBJECTID d
< ':'
< TYPEID Complex
< ')'
< ':'
< TYPEID Bool
< '{'
< IF
< OBJECTID x
< '='
< OBJECTID d
< '.'
< OBJECTID x_value
< '('
< ')'
< THEN
< IF
< OBJECTID y
< '='
< OBJECTID d
< '.'
< OBJECTID y_value
< '('
< ')'
< THEN
< BOOL_CONST true
< ELSE
< BOOL_CONST false
< FI
< ELSE
< BOOL_CONST false
< FI
< '}'
< ';'
< OBJECTID x_value
< '('
< ')'
< ':'
< TYPEID Int
< '{'
< OBJECTID x
< '}'
< ';'
< OBJECTID y_value
< '('
< ')'
< ':'
< TYPEID Int
< '{'
< OBJECTID y
< '}'
< ';'
< '}'
< ';'
---
>  Complex #1 INHERITS
>  IO {
>     x : Int;
>     y : Int;
> 
>     #1 IN
> it(a : Int, b : Int) : Complex {
> 	{
> 	    x = a;
> 	    y = b;
> 	    self;
> 	}
>     };
> 
>     pr#1 IN
> t() : Object {
> 	#1 IF
>  y = 0
> 	#1 THEN
>  out_#1 IN
> t(x)
> 	#1 ELSE
>  out_#1 IN
> t(x).out_str#1 IN
> g("+").out_#1 IN
> t(y).out_str#1 IN
> g("I")
> 	#1 FI
> 
>     };
> 
>     reflect_0() : Complex {
> 	{
> 	    x = ~x;
> 	    y = ~y;
> 	    self;
> 	}
>     };
> 
>     reflect_X() : Complex {
> 	{
> 	    y = ~y;
> 	    self;
> 	}
>     };
> 
>     reflect_Y() : Complex {
> 	{
> 	    x = ~x;
> 	    self;
> 	}
>     };
> 
>     equal(d : Complex) : Bool {
> 	#1 IF
>  x = d.x_value()
> 	#1 THEN
> 
> 	    #1 IF
>  y = d.y_value()
> 	    #1 THEN
>  true
> 	    #1 ELSE
>  false
> 	    #1 FI
> 
> 	#1 ELSE
>  false
> 	#1 FI
> 
>     };
> 
>     x_value() : Int {
> 	x
>     };
> 
>     y_value() : Int {
> 	y
>     };
> };
